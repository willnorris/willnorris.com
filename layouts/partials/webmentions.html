{{- $key := string (delimit (split (trim .RelPermalink "/") "/") ":") -}}
{{- $mentions := index $.Site.Data.mentions $key -}}
<div id="webmentions" class="wrap">
{{- if $mentions -}}
  {{- $likes := slice -}}
  {{- $reposts := slice -}}
  {{- $bookmarks := slice -}}
  {{- $other := slice -}}
  {{- range $index, $element := $mentions -}}
    {{- if eq (index . "wm-property") "like-of" -}}
      {{- $likes = $likes | append . -}}
    {{- else if eq (index . "wm-property") "repost-of" -}}
      {{- $reposts = $reposts | append . -}}
    {{- else if eq (index . "wm-property") "bookmark-of" -}}
      {{- $bookmarks = $bookmarks | append . -}}
    {{- else -}}
      {{- $other = $other | append $element -}}
    {{- end -}}
  {{- end -}}

  <h2>Comments and responses</h2>
  {{- range sort $other "published" }}
  <article id="comment-{{ index . "wm-id" }}" class="p-comment h-entry">
    <div class="comment-meta">
      {{ if .url }}<a href="{{ .url }}"{{ else }}<span{{ end }} class="p-author h-card">
        <img src="{{ default "#" .author.photo }}" alt="" class="u-photo" loading="lazy" decoding="async">
        {{ .author.name }}
      {{ if .url }}</a>{{ else }}</span>{{ end }}
      {{ $date := default (index . "wm-received") .published }}
      <a href="#comment-{{ index . "wm-id" }}">{{ partial "time" $date }}</a>
    </div>
    <div class="e-content">
      {{ .content.html | markdownify }}
    </div>
  </article>
  {{- end }}
{{- end -}}
</div>
